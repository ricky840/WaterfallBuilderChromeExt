<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Waterfall Builder for MoPub Twitter</title>
    <link rel="stylesheet" type="text/css" href="css/semantic.css">
    <link rel="stylesheet" type="text/css" href="css/table-css/semantic-ui/tabulator_semantic-ui.css">
    <link rel="stylesheet" type="text/css" href="css/tagify.css">
		<link rel="stylesheet" type="text/css" href="css/popup.css">
	</head>
	<body>
  <div class="body-wrapper">
		<!-- Menu -->
		<div class="ui tiny menu inverted no-radius mopub-menu borderless">
			<a class="header item" href="">
				<h4 style="margin-bottom: 0px;">Waterfall Builder for</h4>
				<div class="mopub-logo-menu"></div>
			</a>
			<div class="horizontally fitted item" style="width: 50%;">
				<div style="background: white; color: black; width: 100%; font-size: 1.2em;">
					<input id="adunit-selector" class='selectMode'>
				</div>
			</div>
			<a class="item" href="https://app.mopub.com/account" target="_blank">
				<div class="ui orange label logged-in-label">Logged in as</div>
				<div id="logged-in-account" class="logged-in-account"></div>
			</a>
			<div class="right menu">
				<a class="item">
					<div id="add-adsource" class="toggle-line-item-bar">
						<i class="bars icon"></i>
					</div>
				</a>
			</div>
		</div>

		<!-- Loading Bar -->
		<div class="ui grid">
			<div class="one column row no-padding">
				<div class="column">
					<div id="loader-bar" class="ui bottom attached indicating progress inverted blue" data-value="0" style="visibility: hidden;">
						<div class="bar"></div>
					</div>
				</div>
			</div>
		</div>

		<div class="ui grid all-content-wrapper">
			<!-- Loader -->
			<div class="ui dimmer inverted">
				<div class="ui text large loader updating-message update-loader"></div>
			</div>
			<!-- Grid -->
			<div class="ui grid container" style="width: 99% !important;">
				<div class="row">
					<div class="six wide column">
						<div class="adunit-header">
							<h2 class="ui header">
								<span id="info-adunit-name"><div class="ui active inline loader small"></div> Loading..</span>
								<a id="info-adunit-status" class="ui gray empty circular label"></a>
								<button id="reload-ad-unit" class="ui button tiny reload-adunit-button">Reload Waterfall</button>
								<div id="info-adunit-id" class="sub header"></div>
							</h2>
						</div>
					</div>
					<div class="six wide column right floated">
						<span class="waterfall-level-buttons">
							<button id="apply-waterfall" class="ui button tiny mopub-button-color mopub-button-radius right floated" style="display: none;"></button>
							<button id="copy-waterfall" class="ui button tiny mopub-button-color mopub-button-radius right floated">Duplicate Waterfall</button>
							<!-- Download / Upload -->
							<input type="file" id="upload-file" accept=".csv" style="display: none;">
							<button id="waterfall-download-csv" class="ui button tiny right floated mopub-ops-button-color mopub-button-radius waterfall-filter import-export">Export</button>
							<button id="waterfall-upload-csv" class="ui button tiny right floated mopub-ops-button-color mopub-button-radius waterfall-filter import-export">Import</button>
						</span>
						<span class="add-network-done-buttons" style="display: none;">
							<button id="close-add-network" class="ui button tiny mopub-button-color mopub-button-radius add-network" style="float: right;">Done</button>
						</span>
					</div>
				</div>
			</div> <!-- grid end -->
				
			<!-- Grid -->
			<div class="ui grid container" style="width: 99% !important;">
				<div class="ui divider" style="width: 100%; margin: 0px;"></div>
				<!-- Notification -->
				<div class="one column row no-margin">
					<div class="column">
						<div id="notification"></div>
					</div>
				</div>
				
				<div class="row">
					<!-- Waterfall section -->
					<div class="nine wide column" id="waterfall-section">

						<!-- Network templete add btn -->
						<span class="network-add-buttons" style="display: none;" status="hidden">
							<h4 style="margin-bottom: 0.4em;">Select Order</h4>
							<div class="ui search small selection error dropdown add-item-order-list" style="width: 100%;">
								<div class="text"></div>
								<i class="dropdown icon"></i>
							</div>
							<div>
								<button id="add-mpx" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>MPX</button>
								<button id="add-admob" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>AdMob</button>
								<button id="add-adcolony" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>AdColony</button>
								<button id="add-applovin" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>AppLovin</button>
								<button id="add-chartboost" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>Chartboost</button>
								<button id="add-facebook" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>Facebook</button>
								<button id="add-ironsource" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>IronSource</button>
								<button id="add-tapjoy" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>TapJoy</button>
								<button id="add-vungle" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>Vungle</button>
								<button id="add-customsdk" class="ui button tiny mopub-basic-button-color mopub-button-radius add-network add-item"><i class="plus icon"></i>Custom SDK</button>
								<div id="add-direct" class="ui labeled icon dropdown button tiny mopub-basic-button-color mopub-button-radius">
									<i class="plus icon"></i>
									<span class="text">Direct</span>
									<div class="menu">
										<div class="item" data-value="gtee">Guaranteed</div>
										<div class="item" data-value="non_gtee">Non-guaranteed</div>
										<div class="item" data-value="promo">Promotional</div>
										<div class="item" data-value="backfill_promo">Backfill promotional</div>
									</div>
								</div>
							</div>
						</span>

						<span class="edit-delete-item">
							<!-- Edit selected -->
							<button id="edit-selected" class="ui button tiny right floated mopub-button-color mopub-button-radius" style="display: none;"></button>
							<!-- Delete selected -->
							<button id="delete-selected" class="ui button tiny right floated mopub-button-color mopub-button-radius" style="display: none;"></button>
						</span>

						<!-- Status Filter -->
						<div id="status-filter" class="ui dropdown labeled icon button tiny mopub-ops-button-color mopub-button-radius waterfall-filter">
							<i class="filter icon"></i>
							<div class="default text">Filter Status</div>
							<div class="menu">
								<div class="item" data-value="running">
									<div class="ui green empty circular label tiny"></div>Running
								</div>
								<div class="item" data-value="all">
									<div class="ui light blue empty circular label tiny"></div>All
								</div>
								<div class="item" data-value="paused">
									<div class="ui yellow empty circular label tiny"></div>Paused
								</div>
								<div class="item" data-value="archived">
									<div class="ui gray empty circular label tiny"></div>Archived
								</div>
							</div>
						</div>

						<!-- Column Selector -->
						<div id="column-selector" class="ui labeled dropdown icon button tiny mopub-ops-button-color mopub-button-radius waterfall-filter">
							<i class="dropdown icon"></i>
							<span class="ui">Columns</span>
							<div class="menu">
								<div class="ui icon search input">
									<i class="search icon"></i>
									<input type="text" name="Search" placeholder="Search&hellip;">
								</div>
								<div class="scrolling menu"></div>
							</div>
						</div>

						<!-- Sort Reset -->
						<button id="sort-reset" class="ui button tiny mopub-ops-button-color mopub-button-radius waterfall-filter">Reset Sorting</button>

						<!-- Add line items -->
						<button id="add-line-item-btn" class="ui button tiny right floated mopub-button-color mopub-button-radius waterfall-filter">Add New</button>

						<!-- Waterfall Table -->
						<div class="loader-wrapper loader-waterfall-table">
							<div class="ui top aligned inverted dimmer">
								<div class="ui loader"></div>
							</div>
							<div id="waterfall-adunit"></div>
						</div>
						<!-- <button id="delete&#45;selected" class="ui button tiny mopub&#45;button&#45;color mopub&#45;button&#45;radius">Deassign</button> -->
					</div> <!-- Waterfall section end -->

					<!-- Lineitem section -->
					<div class="seven wide column" id="adsource-section">
						<!-- Status Filter -->
						<div id="status-filter-lineitem" class="ui dropdown labeled icon button tiny mopub-ops-button-color mopub-button-radius lineitem-filter">
							<i class="filter icon"></i>
							<div class="default text">Filter Status</div>
							<div class="menu">
								<div class="item" data-value="running">
									<div class="ui green empty circular label tiny"></div>Running
								</div>
								<div class="item" data-value="all">
									<div class="ui light blue empty circular label tiny"></div>All
								</div>
								<div class="item" data-value="paused">
									<div class="ui yellow empty circular label tiny"></div>Paused
								</div>
								<div class="item" data-value="archived">
									<div class="ui gray empty circular label tiny"></div>Archived
								</div>
							</div>
						</div>
						<button class="lineitem-action-buttons ui button tiny mopub-button-color mopub-button-radius" action="duplicate" style="display: none;">Duplicate</button>	
						<button class="lineitem-action-buttons ui button tiny mopub-button-color mopub-button-radius" action="assign" style="display: none;">Assign</button>	
						<div id="loader-lineitem-table">
							<div class="ui top aligned inverted dimmer">
								<div class="ui loader"></div>
							</div>
							<div id="lineitem-list"></div>
						</div>

						<!-- Order -->
						<!-- Status Filter -->
						<div id="status-filter-order" class="ui dropdown labeled icon button tiny mopub-ops-button-color mopub-button-radius order-filter">
							<i class="filter icon"></i>
							<div class="default text">Filter Status</div>
							<div class="menu">
								<div class="item" data-value="running">
									<div class="ui green empty circular label tiny"></div>Running
								</div>
								<div class="item" data-value="all">
									<div class="ui light blue empty circular label tiny"></div>All
								</div>
								<div class="item" data-value="paused">
									<div class="ui yellow empty circular label tiny"></div>Paused
								</div>
								<div class="item" data-value="archived">
									<div class="ui gray empty circular label tiny"></div>Archived
								</div>
							</div>
						</div>
						<button id="load-lineitem-btn" class="ui button blue tiny mopub-button-color mopub-button-radius" style="display: none;"></button>
						<div class="loader-wrapper loader-order-table">
							<div class="ui top aligned inverted dimmer">
								<div class="ui loader"></div>
							</div>
							<div id="order-list"></div>
						</div>
					</div> <!-- Lineitem section end -->

				</div> <!-- Row end -->
			</div> <!-- End of Grid -->
		</div> <!-- End of content wrapper -->
	</div> <!-- End of body wrapper -->

	<footer class="page-footer">
		<span class="wb-version"></span>
		<span>@ricky840@gmail.com</span>
	</footer>

		<!-- Modals -->

		<!-- Copy Waterfall -->
		<div class="ui modal copy-waterfall-modal">
			<i class="close icon"></i>
			<div class="ui header small">Duplicate Waterfall</div>
			<div class="scrolling content">
				<form id="copy-waterfall-form" class="ui form">
					<div class="field">
						<div id="copy-form-notification"></div>
					</div>
					<div class="field">
						<div class="ui info message">
							<p>This will not duplicate <b>Private Marketplace, Marketplace Tab(default), Segment, Advanced Bidding</b> line items.</p>
						</div>
					</div>
					<div class="field">
						<label>Target Line Items</label>
						<div class="ui checkbox">
							<input id="copy-only-selected" type="checkbox">
							<label>Duplicate only selected line items<span id="copy-only-selected-count" class="copy-only-selected-count"></span></label>
						</div>
					</div>
					<div class="field">
						<label>Duplicate Mode</label>
						<select id="copy-mode" class="ui dropdown selection copy-mode-dropdown">
							<option value="in_same_order" selected>Duplicate line items within the current order</option>
							<option value="in_one_new_order">Duplicate line items and merge into a new order</option>
							<option value="in_one_existing_order">Duplicate line items and merge into an existing order</option>
							<option value="in_new_order_with_neighbour">Duplicate line items with the same order structure</option>
						</select>
					</div>
					<div id="copy-form-order-list-field" class="field" style="display: none;">
						<label>Select Order</label>
						<div class="ui search small selection error dropdown copy-form-order-list">
							<div class="text"></div>
							<i class="dropdown icon"></i>
						</div>
					</div>
					<div class="field">
						<div class="ui message">
							<ul class="list">
								<li>Duplicated line items will have suffix of "(new)" in the name.</li>
								<li>Newly created order will have suffix of "(Created by WBExt)" in the name.</li>
							</ul>
						</div>
					</div>
					<div class="field">
						<label>Select Target Ad Unit</label>
						<input id="tagify-adunits">
					</div>
				</form>
			</div>
			<div class="actions">
				<div id="copy-cancel" class="ui tiny deny button mopub-ops-button-color mopub-button-radius">Cancel</div>
				<div id="copy-submit" class="ui right tiny button mopub-button-color mopub-button-radius">Duplicate</div>
			</div>
		</div>

		<!-- Download Format Modal -->
		<div class="ui modal download-option-modal mini">
			<i class="close icon"></i>
			<div class="header">Choose Download Format</div>
			<div class="content">
				<div class="ui tiny header">Including all fields</div>
				<p>Download every field in the waterfall. This format cannot be imported.</p>
				<div class="ui tiny header">Importable fields only</div>
				<p>Download only fields that can be imported. This will export items that has running, paused, archived status only. Custom JS Network, Advanced Bidding, Segment and default MPX line item will not be exported.</p>
				<a class="import-instruction" href="importInstruction.html" target="_blank">Import Instruction</a>
			</div>
			<div class="actions" style="float: left">
				<div class="ui button tiny mopub-button-color mopub-button radius download-button" option="all">Including all fields</div>
				<div class="ui button tiny mopub-button-color mopub-button radius download-button" option="importable">Importable fields only</div>
			</div>
		</div>

		<!-- Review Change Modal -->
		<div class="ui modal large review-change-modal">
			<i class="close icon"></i>
			<div class="ui header small">Review Changes</div>
			<div class="scrolling content">
				<table class="ui table small striped blue">
					<thead>
						<tr>
							<th>Name</th>
							<th>Key</th>
							<th>Action</th>
							<th>Type</th>
							<th>Changes to be made</th>
						</tr>
					</thead>
					<tbody id="change-table-body">
					</tbody>
					<tfoot>
						<tr>
							<th id="change-table-count" colspan="6"></th>
						</tr>
					</tfoot>
				</table>
			</div>
			<div class="actions">
				<div id="review-cancel" class="ui tiny deny button mopub-ops-button-color mopub-button-radius">Cancel</div>
				<div id="review-submit" class="ui tiny ok button mopub-button-color mopub-button-radius">Apply</div>
			</div>
		</div>

		<!-- Edit overrideFields Modal -->
		<div class="ui small modal edit-overridefields-modal">
			<i class="close icon"></i>
			<div id="network-type-title" class="ui header small"></div>
			<!-- Body (form) -->
			<div class="scrolling content">
				<div id="edit-network-form-notification" style="margin-bottom: 10px;"></div>
				<form id="edit-override-form" class="ui form small">
					<div id="network-fields"></div>	
				</form>
			</div>
			<!-- buttons -->
			<div class="actions">
				<div class="ui deny tiny button mopub-ops-button-color mopub-button-radius">Cancel</div>
				<div class="ui ok right tiny button mopub-button-color mopub-button-radius">Edit</div>
			</div>
		</div>

		<!-- Edit Modal -->
		<div class="ui small modal edit-modal">
			<i class="close icon"></i>
			<div class="ui header small">Edit Selected Line Items</div>
			<!-- Body (form) -->
			<div class="scrolling content">
				<form id="edit-form" class="ui form small">
					<div id="edit-form-notification"></div>
					<div class="ui message info">
						<p>For <b>Marketplace (not mpx_line_item) type</b>, only CPM and Status will be updated.</p>
					</div>
					<div class="inline field">
						<label>Rate</label>
						$ <input id="edit-cpm" type="number" name="cpm" min="0.00" step="0.1" max="3000" placeholder="00.00"> CPM
					</div>
					<div class="field">
						<label>Priority</label>
						<select id="edit-priority-select" class="ui dropdown" name="priority">
							<option value="">Priority</option>
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
							<option value="13">13</option>
							<option value="14">14</option>
							<option value="15">15</option>
							<option value="16">16</option>
						</select>
					</div>
					<div class="field">
						<label>Status</label>
						<select id="edit-status-select" class="ui dropdown" name="status">
							<option value="">Status</option>
							<option value="running">Running</option>
							<option value="paused">Paused</option>
							<option value="archived">Archived</option>
						</select>
					</div>
					<h4 class="ui dividing header blue">Geo Targeting</h4>
					<div class="field">
						<label>Geo Targeting Mode</label>
						<select id="target-mode" class="ui dropdown" name="target_mode">
							<option value="">Mode</option>
							<option value="all">All</option>
							<option value="include">Include</option>
							<option value="exclude">Exclude</option>
						</select>
					</div>
					<div class="field disabled">
						<label>Country Trageting</label>
						<div id="target-country" class="ui fluid multiple search selection dropdown">
							<input type="hidden" name="target_country">
							<i class="dropdown icon"></i>
							<div class="default text">Select Country</div>
							<div class="menu"></div>
						</div>
					</div>
					<h4 class="ui dividing header blue">Keyword Targeting</h4>
					<div class="field">
						<label>Keywords</label>
						<input id="tagify-keywords" type="text" placeholder="Enter Keywords" name="keywords">
					</div>
				</form>
			</div> <!-- Content end -->
			<!-- buttons -->
			<div class="actions">
				<div class="ui tiny deny button mopub-ops-button-color mopub-button-radius">Cancel</div>
				<div id="edit-submit" class="ui right tiny button mopub-button-color mopub-button-radius">Edit</div>
			</div>
		</div> <!-- Edit model end -->

		<script type="text/javascript" src="lib/jquery-3.4.1.min.js"></script>
		<script type="text/javascript" src="lib/semantic.min.js"></script>
		<script type="text/javascript" src="/lib/table-js/tabulator.js"></script>
		<script type="text/javascript" src="lib/lodash.js"></script>
		<script type="text/javascript" src="lib/http.js"></script>
		<script type="text/javascript" src="lib/papaparse.min.js"></script>
		<script type="text/javascript" src="lib/tagify.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>

    <script type="text/javascript" src="js/global.js"></script>
    <script type="text/javascript" src="js/notifier.js"></script>
    <script type="text/javascript" src="js/editFormManager.js"></script>
		<script type="text/javascript" src="js/tableFormatters.js"></script> <!-- -->
    <script type="text/javascript" src="js/tableColumnDef.js"></script>
    <script type="text/javascript" src="js/adSourceManager.js"></script>
    <script type="text/javascript" src="js/adUnitManager.js"></script>
    <script type="text/javascript" src="js/overrideFieldValidator.js"></script>
    <script type="text/javascript" src="js/csvManager.js"></script>
    <script type="text/javascript" src="js/waterfallDuplicator.js"></script>
    <script type="text/javascript" src="js/reviewChange.js"></script>
    <script type="text/javascript" src="js/accountManager.js"></script>
    <script type="text/javascript" src="js/addNewLineItem.js"></script>

    <script type="text/javascript" src="js/tableInitializer.js"></script>
    <script type="text/javascript" src="js/orderManager.js"></script>
    <script type="text/javascript" src="js/lineItemManager.js"></script>
    <script type="text/javascript" src="js/moPubUI.js"></script>
    <script type="text/javascript" src="js/loadingIndicator.js"></script>

    <script type="text/javascript" src="js/popupEvents.js"></script>
    <script type="text/javascript" src="js/popup.js"></script>
	</body>
</html>
